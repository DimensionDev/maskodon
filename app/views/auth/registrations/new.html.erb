<h2>Sign up</h2>

<%= form_with(
      model: resource,
      as: resource_name,
      url: registration_path(resource_name),
      data: {
        "challenge_url": new_user_registration_challenge_url,
        "credential_field_name": "#{resource_name}[passkey_credential]"
      }
) do |f| %>
  <%= render "devise/shared/error_messages", resource: resource %>

  <fieldset>
    <table>
      <tr>
        <%= f.simple_fields_for :account do |ff| %>
          <%= ff.input :username, wrapper: :with_label, label: false, required: true, input_html: { 'aria-label': t('simple_form.labels.defaults.username'), autocomplete: 'off', placeholder: t('simple_form.labels.defaults.username'), pattern: '[a-zA-Z0-9_]+', maxlength: 30 }, append: "@#{site_hostname}" %>
        <% end %>
      </tr>
      <tr>
        <th><%= f.label :email %></th>
        <td><%= f.email_field :email, autofocus: true, autocomplete: "email", required: true %></td>
      </tr>
      <tr>
        <th><%= f.label :passkey_label %></th>
        <td><%= f.text_field :passkey_label, autofocus: "off", required: true %>
      </tr>
      <tr>
        <th><%= f.label :password %></th>
        <td><%= f.text_field :password, autofocus: "off", required: true %>
      </tr>
    </table>
  </fieldset>

  <%= f.hidden_field :passkey_credential %>

  <section>
    <button type="submit"><%= image_tag("passkey-black.svg", width: "25", height: "25") %> Sign up</button>
  </section>
<% end %>

<%= render "devise/shared/links" %>


<script type="module">
  import {submitFormEvent} from 'registration_form'

  document.querySelector('form').addEventListener('submit', submitFormEvent)
</script>
